import{_ as ae,Y as D,u as le,Q as ne,a0 as te,f as oe,a as re,r as se,t as ie,B as x,v as ue,e as g,c as y,o as p,d as n,w as t,j as N,b as w,J as de,i as v,z as j,F as I,x as S,l as k,m as fe}from"./index-DgoLVYM5.js";import{r as me}from"./areaDataUtil-DFEcL7pU.js";import{Q as pe}from"./zh-cn-BtBSgXtD.js";import{C as ce,q as ge,D as _e,E as ve,F as he,G as we,H as be,I as E,J as ye,p as Ie,K as Se}from"./pinyin-OA7Wrzh0.js";import{T as ke}from"./index-OWywSwdS.js";import{S as je}from"./SaveOutlined-qoH1ATl7.js";import"./xlsx-BnRkYbvF.js";import"./SettingOutlined-C5aojU4D.js";const Ce={class:"detail-wrap"},De={style:{"font-size":"13px",color:"#a0093c"}},Pe={__name:"detail",setup(Ue){D.locale("zh-cn");const b=le(),Y=ne(),h=te(),M=oe(),P=re(),R=()=>({name:null,alias:null,fullName:null,foundationDate:null,code:[],website:null,briefIntroduction:"",thirdLink:null,stage:null,followStage:null,financeTag:null,industryInfo:[{domain1:null,domain2:null,domain3:null}],memoInfo:[],tags:[]}),e=se({loading:!1,rowGutter:20,colSpan:7,form:R(),rules:{name:[{required:!0,message:"请输入项目名称"},{validator:(l,a)=>a&&e.oldRow.name!==a&&e.projectList.find(r=>r.value===a)?Promise.reject("项目名称重复"):Promise.resolve(),trigger:"blur"}],stage:[{required:!0,message:"请选择项目阶段"}],followStage:[{required:!0,message:"请输入跟进状态"}]},editorOptions:{theme:"snow",placeholder:"请输入",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"]]}},allDomain:[],columns:[{title:"投资时间",align:"center",width:120,dataIndex:"invest_date",customRender:({text:l})=>l?l.length>10?l.substr(0,10):l:""},{title:"轮次",width:160,align:"center",dataIndex:"turn"},{title:"金额",width:120,align:"center",dataIndex:"amount"},{title:"投资方",align:"left",dataIndex:"investor",resizable:!0,width:400}],records:[],orderMap:{},stageList:[],followStageList:[],projectList:[],isNew:!1,oldRow:{},searchKey:"",filterProjects:[]}),F=l=>{if(e.searchKey=l,!l){e.filterProjects=[];return}const a=e.projectList.filter(r=>r.value.includes(l)),o=a.find(r=>r.value===l);if(o!=null&&o.value){e.filterProjects=[...a];return}e.filterProjects=[{value:l,label:l+"(新项目)"},...a]},q=(l=[])=>{const a=e.form.industryInfo.filter(o=>o.domain3).map(o=>o.domain3);ye({params:a.join(",")}).then(o=>{var i;if(!((i=o==null?void 0:o.result)!=null&&i.length))return;let r=o.result[0].assigner.split(",");if(["毛振华","笑容"].includes(b.userInfo.realname)){const u=[];for(const d of r){if(["毛振华","笑容"].includes(d))continue;const f=l.find(c=>c.memo_create_by===d);f?u.push({memo:"",feishu_link:"",...f}):u.push({memo:"",memo_create_by:d,feishu_link:""})}e.form.memoInfo=u}else{const u=l.findIndex(d=>d.memo_create_by===b.userInfo.realname);u===-1?e.form.memoInfo=[{memo:"",memo_create_by:b.userInfo.realname,feishu_link:""}]:e.form.memoInfo=[{memo:l[u].memo||"",memo_create_by:b.userInfo.realname,feishu_link:l[u].feishu_link||""}]}})},A=()=>{const l=e.form.name||h.params.name;if(l==="newnew")return Promise.resolve([]);const a=[];let o=0;return a[o++]=ce({params:l}).then(r=>{e.records=(r==null?void 0:r.result)||[]}).finally(()=>Promise.resolve([])),a[o++]=ge({projName:l}).then(r=>{var i,u,d;(u=(i=r.result)==null?void 0:i.industryInfo)!=null&&u.length&&(e.form.industryInfo=r.result.industryInfo.map(f=>{const c=f.main?f.main.split(","):[],T=f.assistant?f.assistant.split(","):[];return{domain1:f.domain1,domain2:f.domain2,domain3:f.domain3,disabled:(c.includes(b.userInfo.realname)||T.includes(b.userInfo.realname),!1)}})),q(((d=r==null?void 0:r.result)==null?void 0:d.memoInfo)||[])}).finally(()=>Promise.resolve([])),a[o++]=_e({name:l}).then(r=>{const i=(r==null?void 0:r.result)||{};e.oldRow={...i},e.form.projectId=i.projectId;for(const u in e.form)if(!["industryInfo"].includes(u))if(u==="financeTag"){let d=[];i.financingWindowStartTime&&i.financingWindowEndTime&&(d=[D(i.financingWindowStartTime,"YYYY-MM"),D(i.financingWindowEndTime,"YYYY-MM")]),e.form.financeTag=d}else i[u]!=="undefined"&&(e.form[u]=["code","tags"].includes(u)?i[u]?i[u].split(","):[]:i[u])}).finally(()=>Promise.resolve([])),a[o++]=b.getUserList(),Promise.all(a)},U=()=>{const l=[...Y.historyRoutes],a="/project-detail/"+encodeURIComponent(e.form.name),o=l.findIndex(i=>i.path===a),r=h.params.name==="newnew"?-1:l.findIndex(i=>i.path===h.path);o===-1&&r!==-1?(l.splice(r,1,{path:a,name:"project_detail-@id",meta:{title:e.form.name},params:{name:e.form.name}}),console.log(l),Y.setHistoryRoutes(l),M.replace({name:"project_detail-@id",params:{name:e.form.name}})):M.push({path:a})},G=async()=>{e.loading=!0;const l=e.projectList.find(a=>a.value===e.form.name);l!=null&&l.value?(e.isNew=!1,U()):e.isNew=!0,e.loading=!1},W=()=>{e.loading=!0;const l=[];let a=0;l[a++]=ve({pageNo:1,pageSize:1e5}).then(o=>{var r;e.allDomain=((r=o==null?void 0:o.result)==null?void 0:r.records)||[]}).finally(()=>Promise.resolve()),l[a++]=he().then(o=>{let r={};((o==null?void 0:o.result)||[]).forEach(u=>{r[u.name]={...u,nth:u.nth===0||u.name==="未分类I"?1e5:u.nth}}),e.orderMap=r}).finally(()=>Promise.resolve()),l[a++]=we().then(o=>{e.stageList=(o==null?void 0:o.result)||[]}).finally(()=>Promise.resolve()),l[a++]=be().then(o=>{e.followStageList=(o==null?void 0:o.result)||[]}),h.params.name&&h.params.name!=="newnew"&&(l[a++]=A()),l[a++]=E().then(o=>{var r,i;e.projectList=((i=(r=o==null?void 0:o.result)==null?void 0:r.filter)==null?void 0:i.call(r,u=>u.value))||[]}),Promise.all(l).then(o=>{e.loading=!1}).catch(()=>{e.loading=!1})};ie(()=>h.params.name,l=>{var a,o;console.log(l),(o=(a=P.value)==null?void 0:a.resetFields)==null||o.call(a),e.loading=!0,e.records=[],e.oldRow={},e.searchKey="",e.form=R(),A().finally(()=>{e.loading=!1})},{immediate:!0});const B=()=>{e.form.industryInfo.push({domain1:null,domain2:null,domain3:null})};function L(l){return l==null?void 0:l.sort((a,o)=>{let r=e.orderMap[a]?e.orderMap[a].nth:1/0,i=e.orderMap[o]?e.orderMap[o].nth:1/0;return r-i})}const O=x(()=>{const l=e.allDomain.map(a=>a.domain1);return L(Array.from(new Set(l)))}),z=x(()=>l=>{if(!l)return[];const a=e.allDomain.filter(o=>o.domain1===l).map(o=>o.domain2);return L(Array.from(new Set(a)))}),V=x(()=>(l,a)=>{if(!l||!a)return[];const o=e.allDomain.filter(r=>r.domain1===l&&r.domain2===a).map(r=>r.domain3);return L(Array.from(new Set(o)))}),K=l=>{e.form.industryInfo.splice(l,1)},H=l=>{e.form.industryInfo[l].domain2=null,e.form.industryInfo[l].domain3=null},Q=l=>{e.form.industryInfo[l].domain3=null},$=()=>{console.log("保存"),P.value.validate().then(()=>{var o;let l={...e.form,industryInfo:e.form.industryInfo.map(r=>({domain1:r.domain1,domain2:r.domain2,domain3:r.domain3}))};console.log(l),Array.isArray(e.form.financeTag)&&((o=e.form.financeTag)==null?void 0:o.length)===2?(l.financeTag=e.form.financeTag.join(","),l.financingWindowEndTime=D(e.form.financeTag[0]).format("YYYY-MM-DD"),l.financingWindowStartTime=D(e.form.financeTag[1]).format("YYYY-MM-DD")):(l.financeTag=null,l.financingWindowStartTime=null,l.financingWindowEndTime=null),e.form.code.length===3?l.code=e.form.code.join(","):l.code=null,e.form.tags.length?l.tags=e.form.tags.join(","):l.tags=null,e.form.memoInfo.length&&(l.memoInfo=e.form.memoInfo.map(r=>{const i=b.userList.find(u=>u.realname===r.memo_create_by);return{...r,memo_create_by:i==null?void 0:i.username,create_time:new Date}}));let a=null;e.form.projectId?a=Ie:a=Se,e.loading=!0,a(l).then(r=>{fe.success(r.message||"保存成功"),h.params.name==="newnew"?E().then(i=>{var u,d;e.projectList=((d=(u=i==null?void 0:i.result)==null?void 0:u.filter)==null?void 0:d.call(u,f=>f.value))||[]}).finally(()=>{U()}):h.params.name!=="newnew"&&h.params.name!==e.form.name&&U(),e.loading=!1}).catch(r=>{e.loading=!1}),console.log("验证通过",l)}).catch(l=>{console.log("验证失败",l)})};return ue(()=>{console.log("detail route :",h),W()}),(l,a)=>{const o=g("a-button"),r=g("a-affix"),i=g("a-input"),u=g("a-select"),d=g("a-form-item"),f=g("a-col"),c=g("a-row"),T=g("a-date-picker"),J=g("a-cascader"),C=g("a-select-option"),X=g("a-range-picker"),Z=g("a-card"),ee=g("a-form");return p(),y("div",Ce,[n(r,{"offset-top":20,style:{position:"fixed",right:"0px",top:"80px",zIndex:1e3}},{default:t(()=>[n(o,{type:"primary",onClick:$,class:"save-button",disabled:e.loading},{default:t(()=>[n(N(je))]),_:1},8,["disabled"])]),_:1}),n(ee,{model:e.form,name:"basic",ref_key:"formRef",ref:P,"label-col":{flex:"100px"},"wrapper-col":{flex:"1 1 calc(100% - 100px)"},wrap:!1,colon:!1,rules:e.rules,disabled:e.loading,autocomplete:"off",class:"form"},{default:t(()=>[n(Z,{bordered:!1,class:"table-card"},{default:t(()=>[a[15]||(a[15]=w("div",{class:"title-container"},[w("div",{class:"group_6"}),w("span",null," 基本信息 ")],-1)),n(c,{gutter:e.rowGutter},{default:t(()=>[n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"项目名称",name:"name"},de({default:t(()=>[e.form.projectId?(p(),v(i,{key:0,value:e.form.name,"onUpdate:value":a[0]||(a[0]=s=>e.form.name=s),placeholder:"请输入项目名称",allowClear:""},null,8,["value"])):(p(),v(u,{key:1,value:e.form.name,"onUpdate:value":a[1]||(a[1]=s=>e.form.name=s),placeholder:"请选择项目名称",options:e.filterProjects,popupClassName:e.searchKey?"":"is_hide",onSearch:F,onSelect:G,showSearch:"",allowClear:""},null,8,["value","options","popupClassName"]))]),_:2},[!e.form.projectId&&e.form.name&&e.isNew?{name:"extra",fn:t(()=>[w("span",De,j(e.isNew&&!e.form.projectId?"这是一个新项目":""),1)]),key:"0"}:void 0]),1024)]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"项目别名",name:"alias"},{default:t(()=>[n(i,{value:e.form.alias,"onUpdate:value":a[2]||(a[2]=s=>e.form.alias=s),placeholder:"请输入项目别名，用半角逗号分开",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"项目主体",name:"fullName"},{default:t(()=>[n(i,{value:e.form.fullName,"onUpdate:value":a[3]||(a[3]=s=>e.form.fullName=s),placeholder:"请输入项目主体",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["span"])]),_:1},8,["gutter"]),n(c,{gutter:e.rowGutter},{default:t(()=>[n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"成立时间",name:"foundationDate"},{default:t(()=>[n(T,{value:e.form.foundationDate,"onUpdate:value":a[4]||(a[4]=s=>e.form.foundationDate=s),valueFormat:"YYYY-MM-DD",class:"w-full",placeholder:"请选择成立时间",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"省/市/区",name:"code"},{default:t(()=>[n(J,{value:e.form.code,"onUpdate:value":a[5]||(a[5]=s=>e.form.code=s),options:N(me),placeholder:"请选择省/市/区",allowClear:"",class:"mx"},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"项目官网",name:"website"},{default:t(()=>[n(i,{value:e.form.website,"onUpdate:value":a[6]||(a[6]=s=>e.form.website=s),placeholder:"请输入：https:// 或 http://，可双击跳转",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["span"])]),_:1},8,["gutter"]),n(c,null,{default:t(()=>[n(f,{span:21},{default:t(()=>[n(d,{label:"项目简介",name:"briefIntroduction"},{default:t(()=>[n(N(pe),{modelValue:e.form.briefIntroduction,"onUpdate:modelValue":a[7]||(a[7]=s=>e.form.briefIntroduction=s),options:e.editorOptions,contentType:"html"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),n(c,null,{default:t(()=>[n(f,{span:21},{default:t(()=>[n(d,{label:"第三方链接",name:"thirdLink"},{default:t(()=>[n(i,{value:e.form.thirdLink,"onUpdate:value":a[8]||(a[8]=s=>e.form.thirdLink=s),placeholder:"请输入：https:// 或 http://，可双击跳转",allowClear:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),a[16]||(a[16]=w("div",{class:"title-container"},[w("div",{class:"group_6"}),w("span",null," 跟进信息 ")],-1)),n(c,{gutter:e.rowGutter},{default:t(()=>[n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"项目阶段",name:"stage"},{default:t(()=>[n(u,{value:e.form.stage,"onUpdate:value":a[9]||(a[9]=s=>e.form.stage=s),placeholder:"请选择项目阶段",allowClear:""},{default:t(()=>[(p(!0),y(I,null,S(e.stageList,s=>(p(),v(C,{key:s.value,value:s.value},{default:t(()=>[k(j(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"跟进状态",name:"followStage"},{default:t(()=>[n(u,{value:e.form.followStage,"onUpdate:value":a[10]||(a[10]=s=>e.form.followStage=s),placeholder:"请选择跟进状态",allowClear:""},{default:t(()=>[(p(!0),y(I,null,S(e.followStageList,s=>(p(),v(C,{key:s.value,value:s.value},{default:t(()=>[k(j(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"融资窗口",name:"financeTag"},{default:t(()=>[n(X,{value:e.form.financeTag,"onUpdate:value":a[11]||(a[11]=s=>e.form.financeTag=s),picker:"month"},null,8,["value"])]),_:1})]),_:1},8,["span"])]),_:1},8,["gutter"]),(p(!0),y(I,null,S(e.form.industryInfo,(s,_)=>(p(),v(c,{gutter:e.rowGutter,key:_},{default:t(()=>[n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"一级赛道",name:["industryInfo",_,"domain1"],rules:[{required:!0,message:"请选择一级赛道"}]},{default:t(()=>[n(u,{value:s.domain1,"onUpdate:value":m=>s.domain1=m,disabled:s.disabled,placeholder:"请选择一级赛道",onChange:m=>H(_),allowClear:""},{default:t(()=>[(p(!0),y(I,null,S(O.value,m=>(p(),v(C,{key:m,value:m},{default:t(()=>[k(j(m),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled","onChange"])]),_:2},1032,["name"])]),_:2},1032,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"二级赛道",name:["industryInfo",_,"domain2"],rules:[{required:!0,message:"请选择二级赛道"}]},{default:t(()=>[n(u,{value:s.domain2,"onUpdate:value":m=>s.domain2=m,disabled:s.disabled,placeholder:"请选择二级赛道",onChange:m=>Q(_),allowClear:""},{default:t(()=>[(p(!0),y(I,null,S(z.value(s.domain1),m=>(p(),v(C,{key:m,value:m},{default:t(()=>[k(j(m),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled","onChange"])]),_:2},1032,["name"])]),_:2},1032,["span"]),n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"三级赛道",name:["industryInfo",_,"domain3"],rules:[{required:!0,message:"请选择三级赛道"}]},{default:t(()=>[n(u,{value:s.domain3,"onUpdate:value":m=>s.domain3=m,disabled:s.disabled,placeholder:"请选择三级赛道",allowClear:""},{default:t(()=>[(p(!0),y(I,null,S(V.value(s.domain1,s.domain2),m=>(p(),v(C,{key:m,value:m},{default:t(()=>[k(j(m),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])]),_:2},1032,["name"])]),_:2},1032,["span"]),n(f,{span:24-e.colSpan*3},{default:t(()=>[Number(_)===0?(p(),v(o,{key:0,class:"btn",type:"primary",ghost:"",onClick:B},{default:t(()=>a[13]||(a[13]=[k("+")])),_:1,__:[13]})):(p(),v(o,{key:1,class:"btn",danger:"",disabled:s.disabled,onClick:m=>K(_)},{default:t(()=>a[14]||(a[14]=[k("-")])),_:2,__:[14]},1032,["disabled","onClick"]))]),_:2},1032,["span"])]),_:2},1032,["gutter"]))),128)),n(c,{gutter:e.rowGutter},{default:t(()=>[n(f,{span:e.colSpan},{default:t(()=>[n(d,{label:"标签",name:"tags"},{default:t(()=>[n(u,{value:e.form.tags,"onUpdate:value":a[12]||(a[12]=s=>e.form.tags=s),placeholder:"请选择标签",mode:"multiple",allowClear:""},null,8,["value"])]),_:1})]),_:1},8,["span"])]),_:1},8,["gutter"]),(p(!0),y(I,null,S(e.form.memoInfo,(s,_)=>(p(),v(c,{gutter:e.rowGutter,key:_},{default:t(()=>[n(f,{span:13},{default:t(()=>[n(d,{label:s.memo_create_by,name:["memoInfo",_,"feishu_link"]},{default:t(()=>[n(i,{value:s.feishu_link,"onUpdate:value":m=>s.feishu_link=m,placeholder:"请输入飞书链接",allowClear:""},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name"])]),_:2},1024),n(f,{span:8},{default:t(()=>[n(d,{label:"",name:["memoInfo",_,"memo"]},{default:t(()=>[n(i,{value:s.memo,"onUpdate:value":m=>s.memo=m,placeholder:"请输入备注",allowClear:""},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024)]),_:2},1032,["gutter"]))),128)),a[17]||(a[17]=w("div",{class:"title-container"},[w("div",{class:"group_6"}),w("span",null," 投资信息 ")],-1)),n(c,null,{default:t(()=>[n(f,{span:21},{default:t(()=>[n(ke,{tableProps:{scrollToFirstRowOnChange:!0,loading:e.loading,pagination:!1,dataSource:e.records,columns:e.columns,bordered:!0,scroll:{x:"100%"}},isFixedMaxHeight:!1,isShowColumnSetting:!1},null,8,["tableProps"])]),_:1})]),_:1})]),_:1,__:[15,16,17]})]),_:1},8,["model","rules","disabled"])])}}},Ee=ae(Pe,[["__scopeId","data-v-2ca42383"]]);export{Ee as default};
