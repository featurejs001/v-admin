import{S as Ue,F as Ee}from"./filter-ChhuAYjy.js";import{p as fe,q as Be,t as Fe,w as He,x as Je,y as qe,z as Ye,A as Qe,B as We}from"./pinyin-OA7Wrzh0.js";import{r as Ge,g as ce,a as Se,e as Xe,b as Ze,m as et,c as tt,d as ue,f as at}from"./areaDataUtil-DFEcL7pU.js";import{T as Pe}from"./index-OWywSwdS.js";import{d as s,I as re,_ as ie,r as le,e as _,i as w,o as m,w as l,b as v,A as je,H as G,j as I,V as lt,l as k,W as nt,N as me,X as ot,m as L,a as X,t as ge,B as ae,c as D,F as B,x as W,z as A,M as st,y as pe,Y as rt,f as it,v as dt,p as ct,Z as ut,$ as ke,O as Ce,P as pt}from"./index-DgoLVYM5.js";import{Q as ft}from"./zh-cn-BtBSgXtD.js";import{R as mt}from"./fullScreen-i-jRbH7j.js";import"./UploadOutlined-vLwOc4rs.js";import"./xlsx-BnRkYbvF.js";import"./SettingOutlined-C5aojU4D.js";var gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"};function Oe(p){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable}))),c.forEach(function(a){vt(p,a,i[a])})}return p}function vt(p,d,i){return d in p?Object.defineProperty(p,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):p[d]=i,p}var ve=function(d,i){var c=Oe({},d,i.attrs);return s(re,Oe({},c,{icon:gt}),null)};ve.displayName="ExpandOutlined";ve.inheritAttrs=!1;var ht={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M825.8 498L538.4 249.9c-10.7-9.2-26.4-.9-26.4 14v496.3c0 14.9 15.7 23.2 26.4 14L825.8 526c8.3-7.2 8.3-20.8 0-28zm-320 0L218.4 249.9c-10.7-9.2-26.4-.9-26.4 14v496.3c0 14.9 15.7 23.2 26.4 14L505.8 526c4.1-3.6 6.2-8.8 6.2-14 0-5.2-2.1-10.4-6.2-14z"}}]},name:"forward",theme:"outlined"};function xe(p){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable}))),c.forEach(function(a){yt(p,a,i[a])})}return p}function yt(p,d,i){return d in p?Object.defineProperty(p,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):p[d]=i,p}var he=function(d,i){var c=xe({},d,i.attrs);return s(re,xe({},c,{icon:ht}),null)};he.displayName="ForwardOutlined";he.inheritAttrs=!1;var _t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"};function Re(p){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable}))),c.forEach(function(a){wt(p,a,i[a])})}return p}function wt(p,d,i){return d in p?Object.defineProperty(p,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):p[d]=i,p}var ye=function(d,i){var c=Re({},d,i.attrs);return s(re,Re({},c,{icon:_t}),null)};ye.displayName="MergeCellsOutlined";ye.inheritAttrs=!1;var bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"};function Me(p){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable}))),c.forEach(function(a){St(p,a,i[a])})}return p}function St(p,d,i){return d in p?Object.defineProperty(p,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):p[d]=i,p}var _e=function(d,i){var c=Me({},d,i.attrs);return s(re,Me({},c,{icon:bt}),null)};_e.displayName="ScissorOutlined";_e.inheritAttrs=!1;const kt={class:"body"},Ct={class:"search-div"},Ot={__name:"selectModal",props:{title:{type:String,default:"选择用户"},showShare:{type:Boolean,default:!1}},emits:["ok"],setup(p,{expose:d,emit:i}){const c=i,a=le({open:!1,loading:!1,search:{username:"",realname:""},otherParmas:{},shareType:"share",checkAll:!1,indeterminate:!1,selectedRowKeys:[],allData:[],dataSource:[],columns:[{title:"选择",align:"center",dataIndex:"checkbox",slot:"checkbox",titleSlot:"titleCheckbox",width:80},{title:"序号",align:"center",dataIndex:"rowIndex",slot:"commonRowIndex",width:80},{title:"用户账号",align:"center",dataIndex:"username"},{title:"用户姓名",align:"center",dataIndex:"realname"},{title:"手机号码",align:"center",dataIndex:"phone"},{title:"邮箱",align:"center",dataIndex:"email"}]}),e=()=>{let y=[...a.allData];a.username&&(y=y.filter(o=>o.username.indexOf(a.username)>-1)),a.realname&&(y=y.filter(o=>o.realname.indexOf(a.realname)>-1)),a.dataSource=y},z=()=>{a.username="",a.realname="",e()},K=y=>{a.otherParmas=y,a.open=!0,a.loading=!0,ot({pageNo:1,pageSize:1e4}).then(o=>{var b,f;a.dataSource=((b=o==null?void 0:o.result)==null?void 0:b.records)||[],a.allData=((f=o==null?void 0:o.result)==null?void 0:f.records)||[],a.loading=!1}).catch(()=>{a.loading=!1})},R=y=>{const o=a.selectedRowKeys.indexOf(y);o>-1?a.selectedRowKeys.splice(o,1):a.selectedRowKeys.push(y),Object.assign(a,{indeterminate:!!a.selectedRowKeys.length&&a.selectedRowKeys.length<a.dataSource.length,checkAll:a.selectedRowKeys.length===a.dataSource.length})},O=()=>{Object.assign(a,{indeterminate:!1,selectedRowKeys:a.checkAll?a.dataSource.map(y=>y.id):[]})},r=()=>{a.selectedRowKeys=[],a.checkAll=!1,a.indeterminate=!1,a.open=!1},h=()=>{if(!a.selectedRowKeys.length){L.warning("请选择最少一个用户");return}c("ok",{userIds:a.selectedRowKeys,shareType:a.shareType,...a.otherParmas})};return d({handleOpen:K,handleClose:r}),(y,o)=>{const b=_("a-input"),f=_("a-button"),V=_("a-checkbox"),F=_("a-radio"),H=_("a-radio-group"),Y=_("a-col"),Z=_("a-row");return m(),w(me,{modelValue:a.open,"onUpdate:modelValue":o[4]||(o[4]=M=>a.open=M),title:y.$props.title,loading:a.loading,width:"900px",onClose:r,onSubmit:h},{default:l(()=>[v("div",kt,[v("div",Ct,[o[7]||(o[7]=v("div",{class:"label"},"账号",-1)),s(b,{value:a.username,"onUpdate:value":o[0]||(o[0]=M=>a.username=M),placeholder:"请输入账号",allowClear:""},null,8,["value"]),o[8]||(o[8]=v("div",{class:"label"},"姓名",-1)),s(b,{value:a.realname,"onUpdate:value":o[1]||(o[1]=M=>a.realname=M),placeholder:"请输入姓名",allowClear:""},null,8,["value"]),s(f,{type:"primary",class:"btn",icon:G(I(lt)),onClick:e},{default:l(()=>o[5]||(o[5]=[k("查询")])),_:1,__:[5]},8,["icon"]),s(f,{class:"btn reset",icon:G(I(nt)),onClick:z},{default:l(()=>o[6]||(o[6]=[k("重置")])),_:1,__:[6]},8,["icon"])]),s(Pe,{isHideLeft:!0,tableProps:{loading:a.loading,pagination:{total:a.dataSource.length,showTotal:M=>`共 ${M} 条数据`,showQuickJumper:!0},dataSource:a.dataSource,columns:a.columns,bordered:!0,scroll:{x:"100%",y:"500px"}},isFixedMaxHeight:!1},{titleCheckbox:l(M=>[s(V,{checked:a.checkAll,"onUpdate:checked":o[2]||(o[2]=$=>a.checkAll=$),indeterminate:a.indeterminate,class:"custom-checkbox",onChange:O},null,8,["checked","indeterminate"])]),checkbox:l(({record:M})=>[s(V,{checked:a.selectedRowKeys.includes(M.id),class:"custom-checkbox",onChange:$=>R(M.id)},null,8,["checked","onChange"])]),_:1},8,["tableProps"]),y.$props.showShare?(m(),w(Z,{key:0,style:{"margin-top":"12px"}},{default:l(()=>[s(Y,{span:24},{default:l(()=>[s(H,{value:a.shareType,"onUpdate:value":o[3]||(o[3]=M=>a.shareType=M)},{default:l(()=>[s(F,{value:"share"},{default:l(()=>o[9]||(o[9]=[k("共享")])),_:1,__:[9]}),s(F,{value:"push"},{default:l(()=>o[10]||(o[10]=[k("移交")])),_:1,__:[10]})]),_:1},8,["value"])]),_:1})]),_:1})):je("",!0)])]),_:1},8,["modelValue","title","loading"])}}},xt=ie(Ot,[["__scopeId","data-v-24eedee3"]]),Rt={__name:"index",props:{allDomain:{type:Array,default:()=>[]},domains:{type:Array,default:()=>[]}},setup(p,{expose:d}){const i=p,c=X(null),a=le({form:{domains:[]}});ge(()=>i.domains,o=>{a.form.domains=JSON.parse(JSON.stringify(o))},{immediate:!0});const e=ae(()=>{const o=i.allDomain.map(b=>b.domain1);return Array.from(new Set(o))}),z=ae(()=>o=>{if(!o)return[];const b=i.allDomain.filter(f=>f.domain1===o).map(f=>f.domain2);return Array.from(new Set(b))}),K=ae(()=>(o,b)=>{if(!o||!b)return[];const f=i.allDomain.filter(V=>V.domain1===o&&V.domain2===b).map(V=>V.domain3);return Array.from(new Set(f))}),R=()=>{a.form.domains.push({domain1:null,domain2:null,domain3:null})},O=o=>{a.form.domains.splice(o,1)},r=o=>{a.form.domains[o].domain2=null,a.form.domains[o].domain3=null},h=o=>{a.form.domains[o].domain3=null};return d({validate:()=>new Promise((o,b)=>{c.value.validate().then(()=>{o(JSON.parse(JSON.stringify(a.form.domains)))}).catch(f=>{b(f)})})}),(o,b)=>{const f=_("a-select-option"),V=_("a-select"),F=_("a-form-item"),H=_("a-col"),Y=_("a-button"),Z=_("a-row"),M=_("a-form");return m(),w(M,{model:a.form,name:"basic",ref_key:"formRef",ref:c,"label-col":{span:8},"wrapper-col":{span:16},colon:!1,autocomplete:"off",class:"form"},{default:l(()=>[(m(!0),D(B,null,W(a.form.domains,($,U)=>(m(),w(Z,{gutter:20,key:U},{default:l(()=>[s(H,{span:7},{default:l(()=>[s(F,{label:"一级赛道",name:["domains",U,"domain1"],rules:[{required:!0,message:"请选择一级赛道"}]},{default:l(()=>[s(V,{value:$.domain1,"onUpdate:value":C=>$.domain1=C,placeholder:"请选择一级赛道",onChange:C=>r(U),allowClear:""},{default:l(()=>[(m(!0),D(B,null,W(e.value,C=>(m(),w(f,{key:C,value:C},{default:l(()=>[k(A(C),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1032,["name"])]),_:2},1024),s(H,{span:7},{default:l(()=>[s(F,{label:"二级赛道",name:["domains",U,"domain2"],rules:[{required:!0,message:"请选择二级赛道"}]},{default:l(()=>[s(V,{value:$.domain2,"onUpdate:value":C=>$.domain2=C,placeholder:"请选择二级赛道",onChange:C=>h(U),allowClear:""},{default:l(()=>[(m(!0),D(B,null,W(z.value($.domain1),C=>(m(),w(f,{key:C,value:C},{default:l(()=>[k(A(C),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1032,["name"])]),_:2},1024),s(H,{span:7},{default:l(()=>[s(F,{label:"三级赛道",name:["domains",U,"domain3"],rules:[{required:!0,message:"请选择三级赛道"}]},{default:l(()=>[s(V,{value:$.domain3,"onUpdate:value":C=>$.domain3=C,placeholder:"请选择三级赛道",allowClear:""},{default:l(()=>[(m(!0),D(B,null,W(K.value($.domain1,$.domain2),C=>(m(),w(f,{key:C,value:C},{default:l(()=>[k(A(C),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024),s(H,{span:3},{default:l(()=>[Number(U)===0?(m(),w(Y,{key:0,class:"btn",type:"primary",ghost:"",onClick:R},{default:l(()=>b[0]||(b[0]=[k("+")])),_:1,__:[0]})):(m(),w(Y,{key:1,class:"btn",danger:"",onClick:C=>O(U)},{default:l(()=>b[1]||(b[1]=[k("-")])),_:2,__:[1]},1032,["onClick"]))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["model"])}}},Ie=ie(Rt,[["__scopeId","data-v-f072428a"]]),Mt={class:"body"},Pt={class:"center"},jt={class:"center"},It={class:""},$t={__name:"BatchEditModal",props:{stageList:{type:Array,default:()=>[]},followStageList:{type:Array,default:()=>[]},allDomain:{type:Array,default:()=>[]}},emits:["success"],setup(p,{expose:d,emit:i}){const c=i,a=X(null),e=le({open:!1,loading:!1,activeTab:"项目阶段",stage:"",followStage:"",industryInfo:[{domain1:"",domain2:"",domain3:""}],ids:[],rows:[]}),z=()=>{e.stage="",e.followStage="",e.industryInfo=[{domain1:"",domain2:"",domain3:""}],e.ids=[],e.loading=!1,e.open=!1},K=O=>{e.ids=(O==null?void 0:O.ids)||[],e.rows=(O==null?void 0:O.rows)||[],e.open=!0},R=async()=>{if(e.stage){if(!e.followStage){L.warning("请选择跟进阶段");return}}else{L.warning("请选择项目阶段");return}let O;try{const r=await a.value.validate();e.rows.length===1?O={...e.rows[0],stage:e.stage,followStage:e.followStage,industryInfo:r,memoInfo:null}:O=e.rows.map(h=>({...h,stage:e.stage,followStage:e.followStage,industryInfo:r,memoInfo:null}))}catch{L.warning("请选择赛道");return}st.confirm({title:"确定保存",content:`是否确认保存${e.ids.length}条项目信息？`,onOk:()=>{e.loading=!0,fe(O).then(r=>{L.success(r.message),e.open=!1,z(),c("success")}).finally(()=>{e.loading=!1})},onCancel:()=>{}})};return d({handleOpen:K}),(O,r)=>{const h=_("a-select-option"),y=_("a-select"),o=_("a-tab-pane"),b=_("a-tabs");return m(),w(me,{modelValue:e.open,"onUpdate:modelValue":r[3]||(r[3]=f=>e.open=f),title:"批量编辑",loading:e.loading,width:"800px",onClose:z,onSubmit:R},{default:l(()=>[v("div",Mt,[s(b,{activeKey:e.activeTab,"onUpdate:activeKey":r[2]||(r[2]=f=>e.activeTab=f),class:"my-batch-tabs"},{default:l(()=>[s(o,{key:"项目阶段",tab:"项目阶段"},{default:l(()=>[v("div",Pt,[r[4]||(r[4]=v("span",{class:"label"},"项目阶段",-1)),s(y,{value:e.stage,"onUpdate:value":r[0]||(r[0]=f=>e.stage=f),class:"flex-1"},{default:l(()=>[(m(!0),D(B,null,W(O.$props.stageList,f=>(m(),w(h,{key:f,value:f},{default:l(()=>[k(A(f),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),s(o,{key:"跟进阶段",tab:"跟进状态"},{default:l(()=>[v("div",jt,[r[5]||(r[5]=v("span",{class:"label"},"跟进状态",-1)),s(y,{value:e.followStage,"onUpdate:value":r[1]||(r[1]=f=>e.followStage=f),class:"flex-1"},{default:l(()=>[(m(!0),D(B,null,W(O.$props.followStageList,f=>(m(),w(h,{key:f,value:f},{default:l(()=>[k(A(f),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),s(o,{key:"赛道",tab:"赛道"},{default:l(()=>[v("div",It,[s(Ie,{ref_key:"domainRef",ref:a,domains:e.industryInfo,allDomain:p.allDomain},null,8,["domains","allDomain"])])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["modelValue","loading"])}}},At={key:1,class:"mx"},Dt={__name:"EditFieldModal",props:{title:{type:String,default:""},modelValue:{type:Boolean,default:!1},field:{type:String,default:""},record:{type:Object,default:()=>({})},allDomain:{type:Array,default:()=>[]}},emits:["success","close"],setup(p,{emit:d}){const i=d,c=p,a=X(null),e=le({open:!1,loading:!1,apiLoading:!1,value:"",editorOptions:{theme:"snow",placeholder:"请输入",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"]]}}});ae(()=>c.field.includes("domain")?"1000px":"520px");const z=()=>{e.apiLoading=!0,Be({projName:c.record.name}).then(r=>{var h,y;(y=(h=r.result)==null?void 0:h.industryInfo)!=null&&y.length&&(e.value=r.result.industryInfo.map(o=>({domain1:o.domain1,domain2:o.domain2,domain3:o.domain3})))}).finally(()=>{e.apiLoading=!1})};ge(()=>c.modelValue,r=>{switch(e.open=r,c.field){case"provinceMap":case"cityMap":case"regionMap":c.record.province&&c.record.city&&c.record.region?e.value=[c.record.province,c.record.city,c.record.region]:e.value=[];return;case"domain1":case"domain2":case"domain3":e.value=[];break;case"briefIntroduction":e.value=c.record.briefIntroduction;return;default:e.value=c.record[c.field];return}r&&z()},{immediate:!0});const K=async()=>{e.loading=!0;try{const r={...c.record};if(["provinceMap","cityMap","regionMap"].includes(c.field)){if(!e.value||!Array.isArray(e.value)&&e.value.length<3){L.error("请完整选择省市区");return}const[h,y,o]=e.value;r.provinceMap=ce(h),r.cityMap=ce(y),r.regionMap=ce(o),r.province=h,r.city=y,r.region=o,r.code=`${h},${y},${o}`,r.industryInfo=null,r.memoInfo=null}else c.field.includes("domain")?(r.memoInfo=null,r.industryInfo=await a.value.validate()):(r.industryInfo=null,r.memoInfo=null,r[c.field]=e.value);await fe({...r}),L.success("保存成功"),i("success",!0)}catch{}e.loading=!1},R=()=>{i("close",!1)},O=r=>{e.value=r};return(r,h)=>{const y=_("a-cascader"),o=_("a-spin"),b=_("a-textarea");return m(),w(me,{modelValue:e.open,"onUpdate:modelValue":h[3]||(h[3]=f=>e.open=f),title:r.$props.title,loading:e.loading,border:!["briefIntroduction"].includes(r.$props.field),width:r.$props.field.includes("domain")?"1000px":["briefIntroduction"].includes(r.$props.field)?"800px":"720px",onClose:R,onSubmit:K},{default:l(()=>[v("div",{class:pe(["modal-container",["provinceMap","cityMap","regionMap","briefIntroduction"].includes(r.$props.field)?"min-height":""])},[["provinceMap","cityMap","regionMap"].includes(r.$props.field)?(m(),w(y,{key:0,value:e.value,"onUpdate:value":h[0]||(h[0]=f=>e.value=f),options:I(Ge),placeholder:"请选择",allowClear:"",class:"mx",onChange:O},null,8,["value","options"])):r.$props.field.includes("domain")?(m(),D("div",At,[e.apiLoading?(m(),w(o,{key:0})):(m(),w(Ie,{key:1,ref_key:"domainRef",ref:a,domains:e.value,allDomain:p.allDomain},null,8,["domains","allDomain"]))])):["briefIntroduction"].includes(r.$props.field)?(m(),w(I(ft),{key:2,content:e.value,"onUpdate:content":h[1]||(h[1]=f=>e.value=f),options:e.editorOptions,contentType:"html",style:{height:"100%"}},null,8,["content","options"])):(m(),w(b,{key:3,value:e.value,"onUpdate:value":h[2]||(h[2]=f=>e.value=f),placeholder:"请输入",rows:4},null,8,["value"]))],2)]),_:1},8,["modelValue","title","loading","border","width"])}}},Vt=ie(Dt,[["__scopeId","data-v-c6557384"]]),Tt={class:"project-wrap"},Lt={class:"filter-container"},zt={style:{display:"flex","align-items":"center"}},Nt={style:{width:"16px",height:"16px","margin-right":"8px"},t:"1749093877974",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4326",width:"24",height:"24"},Kt=["onClick"],Ut={class:"overflow-ellipsis",style:{cursor:"pointer"}},Et={class:"overflow-ellipsis",style:{cursor:"pointer"}},Bt=["innerHTML"],Ft=["innerHTML","onClick"],Ht=["onClick","innerHTML"],Jt={style:{padding:"8px"}},qt={style:{"max-height":"200px","overflow-y":"auto"}},Yt={style:{"margin-top":"8px","text-align":"center","padding-top":"8px","border-top":"1px solid #f0f0f0"}},Qt={__name:"index",props:{fromWhichComponent:{type:String,default:"project_center"}},setup(p){rt.locale("zh-cn");const d=it(),i=X(null),c=X(null),a=X(null),e=le({loading:!1,selectedOption:"项目列表",params:{total:0,pageNo:1,pageSize:20,sorts:[],filters:{},searchKey:"",isMergeSingle:!0},total:0,recordType:"merge",allRecords:[],filterAllRecords:[],filterRecords:[],statsMap:{},selectedRowKeys:[],filterValuesMap:{},edit:{index:-1,field:"",value:"",modal:!1,showStageSelect:!1},rawProjectRows:[]}),z=X(Se(e.params.filters,e.filterValuesMap,e.filterRecords,e.recordType,e.selectedOption,e.params.isMergeSingle,e.rawProjectRows));ge([()=>e.params.filters,()=>e.filterValuesMap,()=>e.filterRecords,()=>e.recordType,()=>e.selectedOption,()=>e.params.isMergeSingle,()=>e.rawProjectRows],()=>{const n=Se(e.params.filters,e.filterValuesMap,e.filterRecords,e.recordType,e.selectedOption,e.params.isMergeSingle,e.rawProjectRows);z.value=Array.isArray(n)?n:[]},{immediate:!0});const K=ae(()=>e.filterValuesMap[e.edit.field]||[]),R=async()=>{e.loading=!0;let n=Fe,t={column:"investDate",order:"desc",pageNo:1,pageSize:1e5,type:1};switch(e.selectedOption){case"推送列表":n=We,t={column:"op_status",order:"asc",pageNo:1,pageSize:1e5,type:1};break;case"删除列表":n=Qe,t={column:"op_status",order:"asc",pageNo:1,pageSize:1e5,type:1};break}n(t).then(u=>{var x,j,T,E,P,ne,oe,se;["推送列表","删除列表"].includes(e.selectedOption)?(e.allRecords=((x=u==null?void 0:u.result)==null?void 0:x.records)||[],e.total=((j=u==null?void 0:u.result)==null?void 0:j.total)||0):(e.allRecords=((ne=(P=(E=(T=u==null?void 0:u.result)==null?void 0:T.pageList)==null?void 0:E.records)==null?void 0:P.sort)==null?void 0:ne.call(P,(ee,te)=>{if(ee.name===te.name)return new Date(te.investDate)-new Date(ee.investDate)}))||[],e.total=((se=(oe=u==null?void 0:u.result)==null?void 0:oe.pageList)==null?void 0:se.total)||0),h()}).finally(()=>{e.loading=!1})},O=()=>{R()},r=()=>{if(console.log("[调试] getPageRecord recordType:",e.recordType),e.recordType==="merge"){e.params.isMergeSingle=!1;const n=ue([...e.filterAllRecords],e.params.pageNo,e.params.pageSize);e.params.total=n.total,e.filterRecords=n.items}else if(e.params.sorts.filter(t=>["investDate","turn2","amount","investor","domain1","domain2","domain3"].includes(t.field)).length){e.params.isMergeSingle=!1;const t=ue([...e.filterAllRecords],e.params.pageNo,e.params.pageSize);e.params.total=t.total,e.filterRecords=t.items}else{e.params.isMergeSingle=!0;const t=Array.from(new Set(e.filterAllRecords.map(j=>j.name)));e.params.total=t.length;const u=ue([...t],e.params.pageNo,e.params.pageSize);console.log("[调试] 展开模式 names:",t);const x=[];u.items.forEach(j=>{const T=e.filterAllRecords.filter(E=>E.name===j);x.push(...JSON.parse(JSON.stringify(T)))}),console.log("[调试] 展开模式 tempList:",x),e.filterRecords=at(x)}console.log("[调试] getPageRecord filterRecords:",e.filterRecords)},h=async()=>{e.edit.index=-1,e.edit.showStageSelect=!1,e.selectedRowKeys=[];const n=await Ze({data:[...e.allRecords],filters:e.params.filters,searchKey:e.params.searchKey,sorts:e.params.sorts,recordType:e.recordType});e.params.pageNo=1,e.recordType==="merge"?(e.filterAllRecords=et(n),e.rawProjectRows=[...n]):(e.filterAllRecords=[...n],e.rawProjectRows=[]),r(),e.statsMap=tt([...n])},y=n=>{e.params.searchKey=n,h()},o=()=>{var n;e.params.searchKey="",(n=a.value)==null||n.handleClickAll("")},b=n=>{e.params.filters=n.filters||{},e.filterValuesMap=n.filterValuesMap||{},h()},f=async()=>{Xe(e.filterAllRecords)},V=()=>{console.log("handleAdd"),d.push({name:"project_detail-@id",params:{name:"newnew"}})},F=()=>{e.recordType==="merge"?e.recordType="single":e.recordType="merge",h()},H=n=>{var t,u;console.log("handleBatchPush"),(u=(t=i.value)==null?void 0:t.handleOpen)==null||u.call(t,{id:Array.isArray(n)?n.join(","):n})},Y=(n,t,u)=>{var P;let j={...e.filterRecords[n]}[t],T=!1,E=!1;t==="stage"&&e.edit.index===n&&e.edit.field==="stage"&&(E=!0),["domain1","domain2","domain3"].includes(t)?(T=!0,u="赛道编辑"):["provinceMap","cityMap","regionMap"].includes(t)?(T=!0,u="选择地区"):!["foundationDate","thirdLink","website"].includes(t)&&!((P=e.filterValuesMap[t])!=null&&P.length)&&(T=!0),Object.assign(e.edit,{index:n,field:t,value:j,modal:T,title:u,isModal:T,showStageSelect:E}),console.log("handleEdit",e.edit)},Z=n=>new Promise(t=>{Je({id:Array.isArray(n)?n.join(","):n}).then(u=>{u.message&&L.success(u.message),R()}).finally(()=>t(!0))}),M=n=>new Promise(t=>{He({id:Array.isArray(n)?n.join(","):n}).then(u=>{L.success(u.message),R()}).finally(()=>t(!0))}),$=n=>new Promise(t=>{qe({id:Array.isArray(n)?n.join(","):n}).then(u=>{L.success(u.message),R()}).finally(()=>t(!0))}),U=n=>{console.log("handleSelectChange",n),R()},C=n=>{console.log("keys :",n),e.selectedRowKeys.includes(n)?e.selectedRowKeys=e.selectedRowKeys.filter(t=>t!==n):e.selectedRowKeys.push(n)},$e=(n,t,u)=>{var x;console.log("handleCheckboxChange :",n,t,u),(x=a.value)==null||x.handleCheckedTag(t.dataIndex,u)},Ae=(n,t)=>{},De=n=>{var t;(t=a.value)==null||t.handleClickAll(n.dataIndex)},Ve=n=>{Ye({id:n.id,share_type:n.shareType,users:n.userIds.join(",")}).then(t=>{var u,x;L.success(t.message),(x=(u=i.value)==null?void 0:u.handleClose)==null||x.call(u),R()}).catch(()=>{})},Te=()=>{var n,t;(t=(n=c.value)==null?void 0:n.handleOpen)==null||t.call(n,{ids:e.selectedRowKeys,rows:e.selectedRowKeys.map(u=>{const x=e.filterRecords.find(j=>j.projectId===u);return x?{...x}:{projectId:u}})})},Le=n=>{e.params.pageNo=n.current,e.params.pageSize=n.pageSize,r()},ze=n=>{var t,u;(t=n.sorter)!=null&&t.field&&((u=n.sorter)!=null&&u.order)?e.params.sorts=[{field:n.sorter.field,order:n.sorter.order==="ascend"?"asc":"desc"}]:e.params.sorts=[],h()},de=()=>{if(e.edit.index===-1||!e.edit.field||!e.edit.value){L.error("请选择修改项");return}const n={...e.filterRecords[e.edit.index],[e.edit.field]:e.edit.value};fe(n).then(t=>{L.success("修改成功"),e.edit.showStageSelect=!1,R()})},Ne=n=>{d.push({name:"project_detail-@id",params:{name:n.name}})};return dt(()=>{R()}),(n,t)=>{var ee,te,we,be;const u=_("a-button"),x=_("a-popconfirm"),j=_("a-select-option"),T=_("a-select"),E=_("a-checkbox"),P=_("a-tooltip"),ne=_("a-date-picker"),oe=_("a-textarea"),se=_("a-checkbox-group");return m(),D("div",Tt,[v("div",Lt,[s(Ue,{onSearch:y,onClearSearch:o,onSuccess:O,onExport:f}),s(Ee,{ref_key:"filterRef",ref:a,statsMap:e.statsMap,onFilterChange:b},null,8,["statsMap"])]),s(Pe,{tableProps:{scrollToFirstRowOnChange:!0,loading:e.loading,pagination:!1,dataSource:e.filterRecords,columns:z.value,bordered:!0},pagination:{total:e.params.total,current:e.params.pageNo,pageSize:e.params.pageSize,showTotal:g=>`共 ${g} 条数据`,showSizeChanger:!0,showQuickJumper:!0},isFixedMaxHeight:!0,onChange:ze,onPageChange:Le},{"header-left":l(()=>[v("div",zt,[s(u,{type:"primary",ghost:"",icon:G(I(pt)),onClick:V},{default:l(()=>t[9]||(t[9]=[k("新增")])),_:1,__:[9]},8,["icon"]),e.recordType==="merge"?(m(),w(u,{key:0,type:"primary",ghost:"",icon:G(I(ve)),onClick:F},{default:l(()=>t[10]||(t[10]=[k("展开")])),_:1,__:[10]},8,["icon"])):(m(),w(u,{key:1,type:"primary",ghost:"",icon:G(I(ye)),onClick:F},{default:l(()=>t[11]||(t[11]=[k("合并")])),_:1,__:[11]},8,["icon"])),s(u,{type:"primary",ghost:"",disabled:!e.selectedRowKeys.length,onClick:t[0]||(t[0]=g=>H(e.selectedRowKeys))},{icon:l(()=>[(m(),D("svg",Nt,t[12]||(t[12]=[v("path",{d:"M96 800c-10.4 0-21-2.8-30.6-8.2-20.6-11.6-33.4-34.2-33.4-58.8v-442c0-24.8 13-47.4 33.8-59 19.6-11 42.8-10.6 62 1.2l361.4 216.2v-158.4c0-24.8 13-47.4 33.8-59 19.6-11 42.8-10.6 62 1.2l377.6 226c18.4 11 29.4 30.8 29.4 53s-11 42-29.4 53l-377.8 226c-19.4 11.6-42.6 11.8-62.2 0.6-20.6-11.8-33.4-34.4-33.4-58.8v-158L127.6 791.2c-9.8 6-20.8 8.8-31.6 8.8z m457.6-511c-0.2 0.4-0.4 1.2-0.4 2v442c0 1 0.2 1.8 0.4 2.4l373-223.2-373-223.2z m-457.2 0c-0.2 0.4-0.4 1.2-0.4 2v442c0 1 0.2 1.8 0.4 2.4l373-223.2L96.4 289z","p-id":"4327"},null,-1)])))]),default:l(()=>[t[13]||(t[13]=k(" 批量推送 "))]),_:1,__:[13]},8,["disabled"]),s(u,{type:"primary",ghost:"",disabled:!e.selectedRowKeys.length,icon:G(I(ke)),onClick:Te},{default:l(()=>t[14]||(t[14]=[k("批量编辑")])),_:1,__:[14]},8,["disabled","icon"]),s(x,{title:"是否确认删除?",onConfirm:t[1]||(t[1]=()=>M(e.selectedRowKeys))},{default:l(()=>[s(u,{type:"primary",danger:"",disabled:!e.selectedRowKeys.length,ghost:"",icon:G(I(Ce))},{default:l(()=>t[15]||(t[15]=[k("批量删除")])),_:1,__:[15]},8,["disabled","icon"])]),_:1}),s(T,{value:e.selectedOption,"onUpdate:value":t[2]||(t[2]=g=>e.selectedOption=g),style:{width:"120px",height:"36px"},onChange:U},{default:l(()=>[s(j,{value:"项目列表"},{default:l(()=>t[16]||(t[16]=[k("项目列表")])),_:1,__:[16]}),s(j,{value:"推送列表"},{default:l(()=>t[17]||(t[17]=[k("推送列表")])),_:1,__:[17]}),s(j,{value:"删除列表"},{default:l(()=>t[18]||(t[18]=[k("删除列表")])),_:1,__:[18]})]),_:1},8,["value"])])]),checkbox:l(({record:g})=>[s(E,{checked:e.selectedRowKeys.includes(g.projectId),class:"custom-checkbox",onChange:N=>C(g.projectId)},null,8,["checked","onChange"])]),name:l(({column:g,record:N,index:Q,text:J})=>[s(P,{placement:"top",trigger:String(J).length*15>=g.width?"hover":"none"},{title:l(()=>[v("div",null,A(J),1)]),default:l(()=>[v("a",{class:"overflow-ellipsis",style:{color:"rgba(0, 0, 0, 0.65)"},onClick:S=>Ne(N)},A(N.name),9,Kt)]),_:2},1032,["trigger"])]),mainSlot:l(({text:g})=>[s(P,{placement:"top",trigger:String(g).length>8?"hover":"none"},{title:l(()=>[v("div",null,A(g),1)]),default:l(()=>[v("span",Ut,A(g),1)]),_:2},1032,["trigger"])]),assistantSlot:l(({text:g})=>[s(P,{placement:"top",trigger:String(g).length>8?"hover":"none"},{title:l(()=>[v("div",null,A(g),1)]),default:l(()=>[v("span",Et,A(g),1)]),_:2},1032,["trigger"])]),editCommon:l(({column:g,record:N,index:Q,text:J})=>[e.edit.index!==Q?(m(),w(P,{key:0,placement:"top",trigger:g.ellipsis&&String(J).length>10?"hover":"none"},{title:l(()=>[v("div",{innerHTML:J},null,8,Bt)]),default:l(()=>[v("div",{class:pe(["custor-pointer","edit-row",g.ellipsis?"overflow-ellipsis":""]),innerHTML:J,onClick:S=>Y(Q,g.dataIndex,g.title)},null,10,Ft)]),_:2},1032,["trigger"])):e.edit.field!==g.dataIndex||e.edit.isModal||g.dataIndex==="stage"&&!e.edit.showStageSelect?(m(),D("div",{key:1,class:pe(["custor-pointer","edit-span",g.ellipsis?"overflow-ellipsis":""]),onClick:S=>Y(Q,g.dataIndex,g.title),innerHTML:J},null,10,Ht)):K.value.length?(m(),w(T,{key:2,value:e.edit.value,"onUpdate:value":t[3]||(t[3]=S=>e.edit.value=S),size:"small",class:"w-full",onSelect:de},{default:l(()=>[(m(!0),D(B,null,W(K.value,S=>(m(),w(j,{key:S,value:S},{default:l(()=>[k(A(S),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):g.dataIndex==="foundationDate"?(m(),w(ne,{key:3,value:e.edit.value,"onUpdate:value":t[4]||(t[4]=S=>e.edit.value=S),valueFormat:"YYYY-MM-DD",size:"small",class:"w-full",onChange:de},null,8,["value"])):(m(),w(oe,{key:4,value:e.edit.value,"onUpdate:value":t[5]||(t[5]=S=>e.edit.value=S),placeholder:"请输入",rows:4,onBlur:de},null,8,["value"]))]),action1:l(({column:g,record:N,index:Q,text:J})=>[e.edit.index===Q?(m(),w(P,{key:0,placement:"bottom",trigger:"hover"},{title:l(()=>t[19]||(t[19]=[v("span",null,"完成",-1)])),default:l(()=>[s(I(ut),{class:"action-btn",onClick:S=>e.edit.index=-1},null,8,["onClick"])]),_:2},1024)):(m(),w(P,{key:1,placement:"bottom",trigger:"hover"},{title:l(()=>t[20]||(t[20]=[v("span",null,"编辑",-1)])),default:l(()=>[s(I(ke),{class:"action-btn",onClick:S=>Y(Q,"stage",g.title)},null,8,["onClick"])]),_:2},1024)),["项目列表","推送列表"].includes(e.selectedOption)?(m(),D(B,{key:2},[s(P,{placement:"bottom",trigger:"hover"},{title:l(()=>t[21]||(t[21]=[v("span",null,"推送",-1)])),default:l(()=>[s(I(he),{class:"action-btn",onClick:S=>H(N.projectId)},null,8,["onClick"])]),_:2},1024),s(x,{title:"是否确认删除?",onConfirm:()=>M(N.projectId)},{default:l(()=>[s(P,{placement:"bottom",trigger:"hover"},{title:l(()=>t[22]||(t[22]=[v("span",null,"删除",-1)])),default:l(()=>[s(I(Ce),{class:"action-btn danger"})]),_:1})]),_:2},1032,["onConfirm"])],64)):["删除列表"].includes(e.selectedOption)?(m(),D(B,{key:3},[s(x,{title:"是否确认还原?",onConfirm:()=>Z(N.projectId)},{default:l(()=>[s(P,{class:"max-content",placement:"bottom",trigger:"hover"},{title:l(()=>t[23]||(t[23]=[v("span",null,"取回",-1)])),default:l(()=>[s(I(mt),{class:"action-btn"})]),_:1})]),_:2},1032,["onConfirm"]),s(x,{title:"是否确认删除?",onConfirm:()=>$(N.projectId)},{default:l(()=>[s(P,{placement:"bottom",trigger:"hover"},{title:l(()=>t[24]||(t[24]=[v("span",null,"彻底删除",-1)])),default:l(()=>[s(I(_e),{class:"action-btn danger"})]),_:1})]),_:2},1032,["onConfirm"])],64)):je("",!0)]),customFilterDropdown:l(({setSelectedKeys:g,selectedKeys:N,confirm:Q,clearFilters:J,column:S})=>[v("div",Jt,[v("div",qt,[s(se,{value:N,onChange:q=>Ae(q,S),style:{display:"flex","flex-direction":"column","font-size":"13px"}},{default:l(()=>[(m(!0),D(B,null,W(S.filters,q=>(m(),w(E,{key:q.value,value:q.value,class:"custom-checkbox",style:ct({marginBottom:"4px",order:!["provinceMap","cityMap","regionMap"].includes(S.dataIndex)||e.statsMap[S.dataIndex+"-"+q.value]>0?0:1}),onChange:Ke=>$e(Ke,S,q.value)},{default:l(()=>[k(A(q.text)+" ",1),v("span",null,"("+A(e.statsMap[S.dataIndex+"-"+q.value]||0)+")",1)]),_:2},1032,["value","style","onChange"]))),128))]),_:2},1032,["value","onChange"])]),v("div",Yt,[s(u,{size:"small",class:"common_click_btn_style",style:{width:"90px",height:"32px"},onClick:q=>De(S)},{default:l(()=>t[25]||(t[25]=[k(" 重置 ")])),_:2,__:[25]},1032,["onClick"])])])]),_:1},8,["tableProps","pagination"]),s(xt,{ref_key:"userSelectModalRef",ref:i,title:"选择推送用户",showShare:!0,onOk:Ve},null,512),s($t,{ref_key:"batchEditModalRef",ref:c,onSuccess:R,stageList:((ee=e.filterValuesMap)==null?void 0:ee.stage)||[],followStageList:((te=e.filterValuesMap)==null?void 0:te.followStage)||[],allDomain:((we=e.filterValuesMap)==null?void 0:we.allDomain)||[]},null,8,["stageList","followStageList","allDomain"]),s(Vt,{modelValue:e.edit.modal,"onUpdate:modelValue":t[6]||(t[6]=g=>e.edit.modal=g),title:e.edit.title,field:e.edit.field,record:e.filterRecords[e.edit.index],allDomain:((be=e.filterValuesMap)==null?void 0:be.allDomain)||[],onSuccess:t[7]||(t[7]=()=>{e.edit.modal=!1,R()}),onClose:t[8]||(t[8]=()=>{e.edit.modal=!1,e.edit.index=-1})},null,8,["modelValue","title","field","record","allDomain"])])}}},sa=ie(Qt,[["__scopeId","data-v-aed3c1cc"]]);export{sa as default};
