import{_ as Q,a as Z,r as W,t as ee,e as f,i as R,o as v,w as n,d as s,N as te,m as z,u as ae,B as se,v as oe,c as N,b as u,A as K,j as w,D as ne,G as le,F as D,x as E,y as j,O as ie,z as V,H as $,P as re,l as B}from"./index-CwZtB3M4.js";import{p as H,I as de,E as ue,_ as pe,a as me}from"./fullScreen-Bxu300a0.js";import{j as G,k as ce,a as fe,g as S,l as ge,n as _e,e as he,o as ye,s as ve}from"./pinyin-DrVECsdg.js";import{u as we}from"./usePermission-Bpl7caZS.js";import{T as xe}from"./index-DxOTm2Lt.js";import{S as J}from"./SaveOutlined-CXA1CIwi.js";import"./SettingOutlined-C8eYJqIM.js";const Ce=()=>[{title:"一级赛道",align:"center",dataIndex:"domain1",width:200,resizable:!0,sorter:!0,slot:"editCommon"},{title:"二级赛道",align:"center",dataIndex:"domain2",width:200,resizable:!0,sorter:!0,slot:"editCommon"},{title:"三级赛道",align:"center",dataIndex:"domain3",width:200,resizable:!0,sorter:!0,slot:"editCommon"},{title:"优先级",align:"center",dataIndex:"priority",width:100,resizable:!0,sorter:!0,slot:"editCommon"},{title:"主理人",align:"center",dataIndex:"main",width:150,resizable:!0,sorter:!0,slot:"editCommon"},{title:"协理人",align:"center",dataIndex:"assistant",width:150,resizable:!0,sorter:!0,slot:"editCommon"},{title:"操作",align:"center",dataIndex:"action",slot:"action",width:100,resizable:!0,fixed:"right",columnSettingDrag:!1,columnSettingFixed:"bottom"}],be={__name:"AddIndustry",props:{modelValue:{type:Boolean,default:!1}},emits:["success","update:modelValue"],setup(q,{emit:A}){const I=A,e=q,U=Z(null),r=W({loading:!1,open:!1,form:{domain1:"",domain2:"",domain3:"",priority:"",main:[],assistant:[],other:[]},rules:{domain1:[{required:!0,message:"请选择一级赛道"}],domain2:[{required:!0,message:"请选择二级赛道"}],domain3:[{required:!0,message:"请选择三级赛道"}],main:[{required:!0,message:"请选择主理人"}]},priorityList:[],userList:[]});ee(()=>e.modelValue,T=>{var d,b;r.open=T,T?(G("priority2").then(m=>{r.priorityList=m.result||[]}),G("sys_user,realname,realname").then(m=>{r.userList=m.result||[]})):(b=(d=U.value)==null?void 0:d.resetFields)==null||b.call(d)});const O=()=>{I("update:modelValue",!1)},g=async()=>{await U.value.validate(),r.loading=!0;const T={...r.form,main:r.form.main.join(","),assistant:r.form.assistant.join(","),other:r.form.other.join(",")};ce(T).then(d=>{z.success(d.message||"新增成功"),I("success")}).finally(()=>{r.loading=!1})};return(T,d)=>{const b=f("a-input"),m=f("a-form-item"),x=f("a-col"),P=f("a-select"),M=f("a-row"),F=f("a-form");return v(),R(te,{title:"新增",width:"800px",modelValue:r.open,"onUpdate:modelValue":d[7]||(d[7]=p=>r.open=p),loading:r.loading,onClose:O,onSubmit:g},{default:n(()=>[s(F,{model:r.form,rules:r.rules,name:"basic",ref_key:"formRef",ref:U,"label-col":{flex:"90px"},"wrapper-col":{flex:"1 1 calc(100% - 90px)"},colon:!1,autocomplete:"off",class:"form"},{default:n(()=>[s(M,{gutter:20},{default:n(()=>[s(x,{span:12},{default:n(()=>[s(m,{label:"一级赛道",name:"domain1"},{default:n(()=>[s(b,{value:r.form.domain1,"onUpdate:value":d[0]||(d[0]=p=>r.form.domain1=p),placeholder:"请输入一级赛道",allowClear:""},null,8,["value"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"二级赛道",name:"domain2"},{default:n(()=>[s(b,{value:r.form.domain2,"onUpdate:value":d[1]||(d[1]=p=>r.form.domain2=p),placeholder:"请输入二级赛道",allowClear:""},null,8,["value"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"三级赛道",name:"domain3"},{default:n(()=>[s(b,{value:r.form.domain3,"onUpdate:value":d[2]||(d[2]=p=>r.form.domain3=p),placeholder:"请输入三级赛道",allowClear:""},null,8,["value"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"优先级",name:"priority"},{default:n(()=>[s(P,{value:r.form.priority,"onUpdate:value":d[3]||(d[3]=p=>r.form.priority=p),options:r.priorityList,placeholder:"请选择优先级",allowClear:""},null,8,["value","options"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"主理人",name:"main"},{default:n(()=>[s(P,{value:r.form.main,"onUpdate:value":d[4]||(d[4]=p=>r.form.main=p),mode:"multiple",options:r.userList,placeholder:"请选择主理人",allowClear:""},null,8,["value","options"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"协理人",name:"assistant"},{default:n(()=>[s(P,{value:r.form.assistant,"onUpdate:value":d[5]||(d[5]=p=>r.form.assistant=p),mode:"multiple",options:r.userList,placeholder:"请选择协理人",allowClear:""},null,8,["value","options"])]),_:1})]),_:1}),s(x,{span:12},{default:n(()=>[s(m,{label:"其他人",name:"other"},{default:n(()=>[s(P,{value:r.form.other,"onUpdate:value":d[6]||(d[6]=p=>r.form.other=p),mode:"multiple",options:r.userList,placeholder:"请选择其他人",allowClear:""},null,8,["value","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading"])}}},Te=Q(be,[["__scopeId","data-v-7a73ddfc"]]),ke={class:"industry-wrap"},Ie={class:"header"},Pe={class:"first_introduction_text"},Se=["innerHTML"],Re={style:{display:"flex","align-items":"center","flex-grow":"1","flex-wrap":"wrap"}},ze={class:"jeecg-multiple-tabs-content__extra-fold"},Ue={key:0},Le={style:{display:"flex","align-items":"center","flex-grow":"1","flex-wrap":"wrap"}},Ne={class:"industry-contariner"},Ve={style:{display:"flex","align-items":"center"}},Ae=["onClick"],Oe={__name:"config",setup(q){const{hasPermission:A}=we(),I=ae(),e=W({loading:!1,showAdd:!1,tooltips:[],priorityTags:[],selectedPriorityTags:[],peopleTags:[],selectedPeopleTags:[],isMgr:!0,orderMap:{},distinctNames:{},total:0,params:{pageNo:1,pageSize:50,searchKey:""},filterRecords:[],selectedRowKeys:[],options:{domain1:[],domain2:[],domain3:[],main:[],assistant:[],other:[],priority:[]},selectSearch:{domain1:"",domain2:"",domain3:""}}),U=t=>/关注/.test(t)?"text-wrapper_9 guanzhu":/跟进/.test(t)?"text-wrapper_9 genjin":/投后/.test(t)?"text-wrapper_9 touhou":"text-wrapper_9 qita",r=(t,a)=>{const l=e.selectedPriorityTags.indexOf(t);l===-1?e.selectedPriorityTags.push(t):e.selectedPriorityTags.splice(l,1),g()},O=(t,a)=>{const l=e.selectedPeopleTags.indexOf(t);l===-1?e.selectedPeopleTags.push(t):e.selectedPeopleTags.splice(l,1),g()},g=()=>{const t={...e.params};t.column||(t.column="createTime",t.order="desc"),e.selectedPriorityTags.length>0&&(t.priority=e.selectedPriorityTags),e.selectedPeopleTags.length>0&&(t.main_dictText=e.selectedPeopleTags,t.assistant_dictText=e.selectedPeopleTags,t.other_dictText=e.selectedPeopleTags),e.loading=!0,ge(t).then(a=>{var l,o;e.filterRecords=((l=a==null?void 0:a.result)==null?void 0:l.records)||[],e.total=((o=a==null?void 0:a.result)==null?void 0:o.total)||0}).finally(()=>{e.loading=!1})},T=t=>{var a,l;console.log("tableChange :",t),(a=t.sorter)!=null&&a.field&&((l=t.sorter)!=null&&l.order)&&(e.params.column=t.sorter.field,e.params.order=t.sorter.order==="ascend"?"asc":"desc",g())},d=t=>{e.params.pageNo=t.current,e.params.pageSize=t.pageSize,g()},b=t=>{ye({id:t}).then(a=>{z.success(a.message||"删除成功"),g()})},m=(t=null)=>{z.loading({content:"正在保存...",duration:0,key:"saving"}),(t===null||!Array.isArray(t))&&(t=e.filterRecords.filter(l=>e.selectedRowKeys.includes(l.industryId)));const a=t.map(l=>{var o,C,_,k,h,c;return{...l,main:((C=(o=l.main)==null?void 0:o.join)==null?void 0:C.call(o,","))||"",assistant:((k=(_=l.assistant)==null?void 0:_.join)==null?void 0:k.call(_,","))||"",other:((c=(h=l.other)==null?void 0:h.join)==null?void 0:c.call(h,","))||""}});ve(a).then(l=>{z.success(l.message||"保存成功"),g()}).finally(()=>{z.destroy("saving")})},x=()=>{e.showAdd=!0},P=t=>{console.log("handleImportFile :",t);const a=new FormData;a.append("file",t.file),_e(a).then(l=>{z.success(l.message||"导入成功"),g()})},M=()=>{he({column:"createTime",order:"desc"},"v_industry_all_info")},F=t=>{var a,l,o,C,_,k;console.log("edit: ",{...t},e.options),t.main=t.main?(l=(a=t.main)==null?void 0:a.split)==null?void 0:l.call(a,","):[],t.assistant=t.assistant?(C=(o=t.assistant)==null?void 0:o.split)==null?void 0:C.call(o,","):[],t.other=t.other?(k=(_=t.other)==null?void 0:_.split)==null?void 0:k.call(_,","):[],t.domain1=t.domain1||"",t.domain2=t.domain2||"",t.domain3=t.domain3||"",t.priority=t.priority||"",t.isEdit=!0,S("domain1_name_xgdh").then(h=>{e.options.domain1=(h.result||[]).map(c=>({value:c.domain1,label:c.domain1}))}),S("domain2_name_axeh").then(h=>{e.options.domain2=(h.result||[]).map(c=>({value:c.domain2,label:c.domain2}))}),S("domain3_name_zghf").then(h=>{e.options.domain3=(h.result||[]).map(c=>({value:c.domain3,label:c.domain3}))})},p=se(()=>t=>{const a=e.options[t];return console.log("options :",t,a),t.includes("domain")?a.findIndex(o=>o.value===e.selectSearch[t])===-1?[...a,{value:e.selectSearch[t],label:e.selectSearch[t]}]:[...a]:[...a]});return oe(async()=>{fe().then(o=>{e.tooltips=o.result||[]});const t=(await I.getUserList()).map(o=>({value:o.realname,label:o.realname}));e.options.main=[...t],e.options.assistant=[...t],e.options.other=[...t],I.gUserRoles.includes("mgr")&&I.gUserRoles.includes("admin")?e.isMgr=!1:e.isMgr=!0;let a=await S("realname_industry_count_23e");e.peopleTags=a.result.filter(o=>o.realname!="管理员rootroot").map(o=>(e.distinctNames[o.realname]=o.industry_count,o.realname)),e.isMgr?a=await S("priority_industry_count_fde"):a=await S("touyan_priority_industry_count_ghw");const l=a.result.map(o=>(e.distinctNames[o.priority]=o.industry_count,o.priority));l.sort((o,C)=>H[o]-H[C]),e.priorityTags=[...l],e.options.priority=l.filter(o=>o).map(o=>({value:o,label:o})),g()}),(t,a)=>{const l=f("a-tooltip"),o=f("a-checkable-tag"),C=f("a-upload"),_=f("a-button"),k=f("a-input-search"),h=f("a-select"),c=f("a-popconfirm");return v(),N("div",ke,[u("div",Ie,[u("div",null,[u("div",Pe,[a[4]||(a[4]=u("span",{class:""},"行业等级",-1)),e.tooltips.length?(v(),R(l,{key:0,placement:"right",overlayClassName:"1"},{title:n(()=>[u("div",{innerHTML:w(le)(e.tooltips,"行业中心","行业等级说明").replace(/\|/g,"<br/>")},null,8,Se)]),default:n(()=>[s(w(ne),{class:"info-circle"})]),_:1})):K("",!0)]),u("div",Re,[(v(!0),N(D,null,E(e.priorityTags,i=>(v(),R(o,{checked:e.selectedPriorityTags.includes(i),id:i,key:i,class:j([U(i),e.selectedPriorityTags.includes(i)?"checked":""]),onChange:y=>r(i)},{default:n(()=>[u("span",null,V(i),1),u("span",null,"("+V(e.distinctNames[i])+")",1)]),_:2},1032,["checked","id","class","onChange"]))),128))]),u("div",{id:"config",style:{display:"flex","align-items":"center","margin-left":"auto","margin-top":"6px"},class:j(e.globalMode==="edit"?"disabled":"")},[s(l,{placement:"top"},{title:n(()=>a[5]||(a[5]=[u("span",null,"导入",-1)])),default:n(()=>[w(A)("project_list:import")?(v(),R(C,{key:0,class:"flex",customRequest:i=>P(i),showUploadList:!1,name:"file"},{default:n(()=>[u("span",ze,[s(w(de),{class:"icon-wrapper mr"})])]),_:1},8,["customRequest"])):K("",!0)]),_:1}),s(l,{placement:"top"},{title:n(()=>a[6]||(a[6]=[u("span",null,"导出",-1)])),default:n(()=>[s(w(ue),{class:"icon-wrapper",onClick:M})]),_:1}),a[8]||(a[8]=u("div",{class:"divider"},null,-1)),s(pe,{customClass:"icon-wrapper mr"}),s(l,{placement:"top"},{title:n(()=>a[7]||(a[7]=[u("span",null,"重新载入",-1)])),default:n(()=>[s(me,{customClass:"icon-wrapper",loading:e.loading},null,8,["loading"])]),_:1})],2)]),e.isMgr?(v(),N("div",Ue,[a[9]||(a[9]=u("div",{class:"first_introduction_text"},"负责人",-1)),u("div",Le,[(v(!0),N(D,null,E(e.peopleTags,i=>(v(),R(o,{key:i,checked:e.selectedPeopleTags.includes(i),class:j(["text-wrapper_9 qita",e.selectedPeopleTags.includes(i)?"checked":"",e.globalMode==="edit"?"disabled":""]),onChange:y=>O(i)},{default:n(()=>[u("span",null,V(i),1),u("span",null,"("+V(e.distinctNames[i])+")",1)]),_:2},1032,["checked","class","onChange"]))),128))])])):K("",!0)]),u("div",Ne,[s(xe,{tableProps:{scrollToFirstRowOnChange:!0,loading:e.loading,pagination:!1,dataSource:e.filterRecords,columns:w(Ce)(),bordered:!0,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:i=>e.selectedRowKeys=i},rowKey:"industryId"},pagination:{total:e.total,current:e.params.pageNo,pageSize:e.params.pageSize,showTotal:i=>`共 ${i} 条数据`,showSizeChanger:!0,showQuickJumper:!0},isFixedMaxHeight:!0,onChange:T,onPageChange:d},{"header-left":n(()=>[u("div",Ve,[s(_,{type:"primary",class:"mr-8",ghost:"",icon:$(w(re)),onClick:x},{default:n(()=>a[10]||(a[10]=[B("新增")])),_:1,__:[10]},8,["icon"]),s(_,{type:"primary",class:"mr-8",ghost:"",icon:$(w(J)),disabled:!e.selectedRowKeys.length,onClick:a[0]||(a[0]=i=>m())},{default:n(()=>a[11]||(a[11]=[B("保存")])),_:1,__:[11]},8,["icon","disabled"]),s(k,{value:e.params.searchKey,"onUpdate:value":a[1]||(a[1]=i=>e.params.searchKey=i),"enter-button":"",placeholder:"输入关键字搜索",style:{width:"200px"},class:"mr-8",onSearch:g},null,8,["value"])])]),editCommon:n(({column:i,record:y,index:X,text:Y})=>[y.isEdit?(v(),R(h,{key:1,class:"w-full",value:y[i.dataIndex],"onUpdate:value":L=>y[i.dataIndex]=L,showSearch:!["priority"].includes(i.dataIndex),mode:Array.isArray(y[i.dataIndex])?"multiple":"combobox",options:p.value(i.dataIndex),onSearch:L=>e.selectSearch[i.dataIndex]=L},null,8,["value","onUpdate:value","showSearch","mode","options","onSearch"])):(v(),N("div",{key:0,class:"w-full min-h-22 custor-pointer",onClick:L=>F(y)},V(y[i.dataIndex]),9,Ae))]),action:n(({column:i,record:y,index:X,text:Y})=>[s(c,{title:"是否确认删除?",onConfirm:()=>b(y.industryId)},{default:n(()=>[s(l,{placement:"bottom",trigger:"hover"},{title:n(()=>a[12]||(a[12]=[u("span",null,"删除",-1)])),default:n(()=>[s(w(ie),{class:"action-btn danger"})]),_:1})]),_:2},1032,["onConfirm"]),s(l,{placement:"bottom",trigger:"hover"},{title:n(()=>a[13]||(a[13]=[u("span",null,"保存",-1)])),default:n(()=>[s(w(J),{class:"action-btn save",onClick:L=>m([y])},null,8,["onClick"])]),_:2},1024)]),_:1},8,["tableProps","pagination"])]),s(Te,{modelValue:e.showAdd,"onUpdate:modelValue":a[2]||(a[2]=i=>e.showAdd=i),onSuccess:a[3]||(a[3]=()=>{e.showAdd=!1,e.params.pageNo=1,g()})},null,8,["modelValue"])])}}},$e=Q(Oe,[["__scopeId","data-v-99b61fde"]]);export{$e as default};
